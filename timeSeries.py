import readFromDatabase as rfd
import matplotlib.pyplot as plt
from sklearn.linear_model import LinearRegression
import scipy.stats as ss

list=[('gender', 'female'), ('cars', 'access to car (1+)'), ('married', 'married'),
      ('working', 'employed/self-employed (full or part time)')]
for item in list:
    plt.figure(figsize=(8, 8))
    data=rfd.readCertainVisitor('visitor', item[0], item[1]).groupby('Year').sum().reset_index()
    #print(data.corr())
    #print(data.corr(method='spearman'))
    plt.scatter(data['Year'], data['Count'])
    x=data['Year'].values.reshape(-1, 1)
    y=data['Count'].values.reshape(-1, 1)
    reg=LinearRegression()
    reg.fit(x, y)
    print(item)
    print("The linear model is: y = {:.5} + {:.5}x".format(reg.intercept_[0], reg.coef_[0][0]))
    predictions = reg.predict(x)
    kf = ss.chisquare(data['Count'].to_list(), f_exp=predictions.flatten())
    print(kf)
    print(rfd.meanAbsoluteError(data['Count'].to_list(), predictions.flatten()))
    plt.plot(data['Year'], predictions)
    plt.xlabel('Year')
    plt.ylabel('Number of Visitors')
    plt.title('Number of visistors in '+item[1])
    plt.savefig('timeSeries/'+item[0]+'_time_series.png')
    plt.show()
list=[12.29819540279861, 11.278485825731076, 9.85705219195776, 12.783605355143383, 13.324147350708994, 12.692912311176851, 15.210175550265769, 15.31063863967911, 12.446807405356695, 13.055550853382137, 11.008618216675362, 11.3551891262509, 10.858375997995577, 10.547890557784164, 10.052595820821091, 13.821665376065091, 11.255565596769356, 12.978872691478951, 13.7242019782232, 14.613324240394826, 13.577581164421296, 13.469215037257346, 9.47741368428768, 10.32185751813011, 12.578491636928625, 10.658517337720768, 11.266685353547889, 11.374349620651019, 10.411517800492526, 12.734687561939149, 17.259326699947742, 14.36815112847019, 12.64868004348912, 11.474564220904407, 10.022136975538128, 11.924087435449723, 10.241050137035701, 10.928153873601403, 10.31597913591476, 14.150782421009763, 9.595971501236743, 13.692974367692907, 12.777658352433633, 16.169883092375144, 13.274519898669672, 11.721834959637516, 10.248363019771652, 11.301952299987617, 10.409651495868301, 9.59419695227325, 12.588713290193178, 12.11140476599624, 10.995182483133192, 10.530337223865502, 14.581691986665316, 13.478865743146955, 15.199347217686375, 10.82594683219174, 12.138861454131074, 9.891399804260375, 10.910515617541389, 9.484398594512633, 12.044756720054842, 11.875026878261448, 10.048383665348183, 11.80159341735364, 13.074333318699441, 15.538083860228305, 11.476036635230258, 11.418906690467711, 10.747941520107288, 11.876593550502042, 9.877213622139934, 9.679917990888487, 10.062854676509227, 11.348007304341838, 11.262043420958049, 12.936014133728525, 12.12129008029449, 13.000710163370696, 13.079171069330451, 12.40382226198477, 10.756449430833337, 10.685089994238124, 10.372074313836764, 10.084384832113136, 10.10495968366646, 10.603022569936346, 11.202375390513778, 12.220967255066665, 13.770698571947996, 13.42501470377252, 11.739663007917018, 11.3200668771569, 11.646477278145625, 11.16451836317375]
output=[]
sum=0
for i in range(len(list)):
    if i%12!=0:
        sum+=list[i]
    else:
        output.append(sum)
        sum=list[i]
output.append(sum)
print(output)
